from __future__ import division
import scraperwiki
# This is a template for a Python scraper on Morph (https://morph.io)
# including some code snippets below that you should find helpful
    
constituencyslugs=['isle-of-wight']

#nodrop - 0 if you want to drop, 1 if you don't
nodrop=1

import requests
import datetime
from bs4 import BeautifulSoup

def dropper(table):
    """ Helper function to drop a table """
    if nodrop==1: return
    print "dropping",table
    if table!='':
        try: scraperwiki.sqlite.execute('drop table "'+table+'"')
        except: pass
        
def urlbuilder_constituency(constslug):
  return 'http://www.oddschecker.com/politics/british-politics/{0}/winning-party'.format(constslug)

def makeSoup(url):
	try:
		r = requests.get(url)
		#print '>>>',r.history
		ret= BeautifulSoup(r.text)
		for s in r.history:
			if s.status_code==302: ret==""
	except: ret=""
	return ret

def oddsGrabber(soup,default):
  if soup=="": return {}
  #soup=makeSoup(url)
  table=soup.find( "tbody", {"id":"t1"} )
  allbets=default
  allbets['time']=datetime.datetime.utcnow()
  bets={}
  for row in table.findAll('tr'):
    name=row('td')[1].string
    tds = row('td')[3:]
    bets[name]={}
    for td in tds:
      if td.string!=None:
        try:
          bets[name][ td['id'].split('_')[1] ]=td.string
        except: pass
  allbets['odds']=bets
  return allbets

def oddsGrabber_constituency(constslug,default):
  url=urlbuilder_constituency(constslug)
  soup=makeSoup(url)
  if soup=='':
    return {}
  return oddsGrabber(soup,default)

def oddsParser(odds):
  bigodds=[]
  oddsdata=odds['odds']
  for party in oddsdata:
    #data in tidy format
    data={'time':odds['time'],'constituency':odds['const']}
    for bookie in oddsdata[party]:
      data['party']=str(party)
      data['bookie']=str(bookie)
      data['oddsraw']=str(oddsdata[party][bookie])
      data['odds']=eval(data['oddsraw'])
      bigodds.append(data.copy()) 
  return bigodds

typ='constituency2015GE'
dropper(typ)

scraperwiki.sqlite.execute("CREATE TABLE IF NOT EXISTS 'constituency2015GE' ( 'time' datetime , 'bookie' text, 'party' text, 'odds' real, 'oddsraw' text, 'constituency' text)")
	
for const in constituencyslugs:
  odds=oddsGrabber_constituency(const,{'typ':typ,'const':const})
  oddsdata=oddsParser(odds)
  scraperwiki.sqlite.save(unique_keys=[],table_name=typ, data=oddsdata)




#General election overall

def urlbuilder_generic(path,slug):
  return 'http://www.oddschecker.com/{0}/{1}'.format(path,slug)

def oddsGrabber_generic(path,slug,default):
  url=urlbuilder_generic(path, slug)
  soup=makeSoup(url)
  if soup=='':
    return {}
  return oddsGrabber(soup,default)

def oddsParser_generic(odds):
  bigodds=[]
  oddsdata=odds['odds']
  for outcome in oddsdata:
    #data in tidy format
    data={'time':odds['time'],'typ':odds['typ']}
    for bookie in oddsdata[outcome]:
      data['outcome']=str(outcome)
      data['bookie']=str(bookie)
      data['oddsraw']=str(oddsdata[outcome][bookie])
      data['odds']=eval(str(data['oddsraw']))
      bigodds.append(data.copy()) 
  return bigodds

typ='overall2015GE'
dropper(typ)

scraperwiki.sqlite.execute("CREATE TABLE IF NOT EXISTS 'overall2015GE' ( 'time' datetime , 'bookie' text, 'outcome' text, 'odds' real, 'oddsraw' text, 'typ' text)")
bigslugs=[('politics/british-politics/next-uk-general-election','next-government')]	
for path, slug in bigslugs:
  odds=oddsGrabber_generic(path,slug,{'typ':typ})
  oddsdata=oddsParser_generic(odds)
  scraperwiki.sqlite.save(unique_keys=[],table_name=typ, data=oddsdata)
 
#full...
constituencyslugs=["/politics/british-politics/aberavon/winning-party","/politics/british-politics/aberconwy/winning-party","/politics/british-politics/aberdeen-north/winning-party","/politics/british-politics/aberdeen-south/winning-party","/politics/british-politics/aberdeenshire-west-and-kincardine/winning-party","/politics/british-politics/airdrie-and-shotts/winning-party","/politics/british-politics/aldershot/winning-party","/politics/british-politics/aldridge-brownhills/winning-party","/politics/british-politics/altrincham-and-sale-west/winning-party","/politics/british-politics/alyn-and-deeside/winning-party","/politics/british-politics/amber-valley/winning-party","/politics/british-politics/angus/winning-party","/politics/british-politics/antrim-east/winning-party","/politics/british-politics/antrim-north/winning-party","/politics/british-politics/antrim-south/winning-party","/politics/british-politics/arfon/winning-party","/politics/british-politics/argyll-and-bute/winning-party","/politics/british-politics/arundel-and-south-downs/winning-party","/politics/british-politics/ashfield/winning-party","/politics/british-politics/ashford/winning-party","/politics/british-politics/ashton-under-lyne/winning-party","/politics/british-politics/aylesbury/winning-party","/politics/british-politics/ayr-carrick-and-cumnock/winning-party","/politics/british-politics/ayrshire-central/winning-party","/politics/british-politics/ayrshire-north-and-arran/winning-party","/politics/british-politics/banbury/winning-party","/politics/british-politics/banff-and-buchan/winning-party","/politics/british-politics/barking/winning-party","/politics/british-politics/barnsley-central/winning-party","/politics/british-politics/barnsley-east/winning-party","/politics/british-politics/barrow-and-furness/winning-party","/politics/british-politics/basildon-south-and-east-thurrock/winning-party","/politics/british-politics/basildon-and-billericay/winning-party","/politics/british-politics/basingstoke/winning-party","/politics/british-politics/bassetlaw/winning-party","/politics/british-politics/bath/winning-party","/politics/british-politics/batley-and-spen/winning-party","/politics/british-politics/battersea/winning-party","/politics/british-politics/beaconsfield/winning-party","/politics/british-politics/beckenham/winning-party","/politics/british-politics/bedford/winning-party","/politics/british-politics/bedfordshire-mid/winning-party","/politics/british-politics/bedfordshire-north-east/winning-party","/politics/british-politics/bedfordshire-south-west/winning-party","/politics/british-politics/belfast-east/winning-party","/politics/british-politics/belfast-north/winning-party","/politics/british-politics/belfast-south/winning-party","/politics/british-politics/belfast-west/winning-party","/politics/british-politics/bermondsey-and-southwark/winning-party","/politics/british-politics/berwick-upon-tweed/winning-party","/politics/british-politics/berwickshire-roxburgh-and-selkirk/winning-party","/politics/british-politics/bethnal-green-and-bow/winning-party","/politics/british-politics/beverley-and-holderness/winning-party","/politics/british-politics/bexhill-and-battle/winning-party","/politics/british-politics/bexleyheath-and-crayford/winning-party","/politics/british-politics/birkenhead/winning-party","/politics/british-politics/birmingham-edgbaston/winning-party","/politics/british-politics/birmingham-erdington/winning-party","/politics/british-politics/birmingham-hall-green/winning-party","/politics/british-politics/birmingham-hodge-hill/winning-party","/politics/british-politics/birmingham-ladywood/winning-party","/politics/british-politics/birmingham-northfield/winning-party","/politics/british-politics/birmingham-perry-barr/winning-party","/politics/british-politics/birmingham-selly-oak/winning-party","/politics/british-politics/birmingham-yardley/winning-party","/politics/british-politics/bishop-auckland/winning-party","/politics/british-politics/blackburn/winning-party","/politics/british-politics/blackley-and-broughton/winning-party","/politics/british-politics/blackpool-north-and-cleveley/winning-party","/politics/british-politics/blackpool-south/winning-party","/politics/british-politics/blaenau-gwent/winning-party","/politics/british-politics/blaydon/winning-party","/politics/british-politics/blyth-valley/winning-party","/politics/british-politics/bognor-regis-and-littlehampton/winning-party","/politics/british-politics/bolsover/winning-party","/politics/british-politics/bolton-north-east/winning-party","/politics/british-politics/bolton-south-east/winning-party","/politics/british-politics/bolton-west/winning-party","/politics/british-politics/bootle/winning-party","/politics/british-politics/boston-and-skegness/winning-party","/politics/british-politics/bosworth/winning-party","/politics/british-politics/bournemouth-east/winning-party","/politics/british-politics/bournemouth-west/winning-party","/politics/british-politics/bracknell/winning-party","/politics/british-politics/bradford-east/winning-party","/politics/british-politics/bradford-south/winning-party","/politics/british-politics/bradford-west/winning-party","/politics/british-politics/braintree/winning-party","/politics/british-politics/brecon-and-radnorshire/winning-party","/politics/british-politics/brent-central/winning-party","/politics/british-politics/brent-north/winning-party","/politics/british-politics/brentford-and-isleworth/winning-party","/politics/british-politics/brentwood-and-ongar/winning-party","/politics/british-politics/bridgend/winning-party","/politics/british-politics/bridgewater-and-west-somerset/winning-party","/politics/british-politics/brigg-and-goole/winning-party","/politics/british-politics/brighton-kemptown/winning-party","/politics/british-politics/brighton-pavilion/winning-party","/politics/british-politics/bristol-east/winning-party","/politics/british-politics/bristol-north-west/winning-party","/politics/british-politics/bristol-south/winning-party","/politics/british-politics/bristol-west/winning-party","/politics/british-politics/broadland/winning-party","/politics/british-politics/bromley-and-chislehurst/winning-party","/politics/british-politics/bromsgrove/winning-party","/politics/british-politics/broxbourne/winning-party","/politics/british-politics/broxtowe/winning-party","/politics/british-politics/buckingham/winning-party","/politics/british-politics/burnley/winning-party","/politics/british-politics/burton/winning-party","/politics/british-politics/bury-north/winning-party","/politics/british-politics/bury-south/winning-party","/politics/british-politics/bury-st-edmunds/winning-party","/politics/british-politics/caerphilly/winning-party","/politics/british-politics/caithness-sutherland-and-easter-ross/winning-party","/politics/british-politics/calder-valley/winning-party","/politics/british-politics/camberwell-and-peckham/winning-party","/politics/british-politics/camborne-and-redruth/winning-party","/politics/british-politics/cambridge/winning-party","/politics/british-politics/cambridgeshire-n-e/winning-party","/politics/british-politics/cambridgeshire-nw/winning-party","/politics/british-politics/cambridgeshire-south/winning-party","/politics/british-politics/cambridgeshire-south-east/winning-party","/politics/british-politics/cannock-chase/winning-party","/politics/british-politics/canterbury/winning-party","/politics/british-politics/cardiff-central/winning-party","/politics/british-politics/cardiff-north/winning-party","/politics/british-politics/cardiff-sth-and-penarth/winning-party","/politics/british-politics/cardiff-west/winning-party","/politics/british-politics/carlisle/winning-party","/politics/british-politics/carmarthen-est-and-dinefw/winning-party","/politics/british-politics/carmarthen-wst-and-sth-pembrokshire/winning-party","/politics/british-politics/carshalton-and-wallington/winning-party","/politics/british-politics/castle-point/winning-party","/politics/british-politics/ceredigion/winning-party","/politics/british-politics/charnwood/winning-party","/politics/british-politics/chatham-and-alyesford/winning-party","/politics/british-politics/cheadle/winning-party","/politics/british-politics/chelmsford/winning-party","/politics/british-politics/chelsea-and-fulham/winning-party","/politics/british-politics/cheltenham/winning-party","/politics/british-politics/chesham-and-amersham/winning-party","/politics/british-politics/chesterfield/winning-party","/politics/british-politics/chichester/winning-party","/politics/british-politics/chingford-and-woodford-gr/winning-party","/politics/british-politics/chippenham/winning-party","/politics/british-politics/chipping-barnet/winning-party","/politics/british-politics/chorley/winning-party","/politics/british-politics/christchurch/winning-party","/politics/british-politics/cities-of-london-and-west/winning-party","/politics/british-politics/city-of-durham/winning-party","/politics/british-politics/city-of-chester/winning-party","/politics/british-politics/clacton/winning-party","/politics/british-politics/cleethorpes/winning-party","/politics/british-politics/clwyd-south/winning-party","/politics/british-politics/clwyd-west/winning-party","/politics/british-politics/coatbridge-chryston-and-bellshill/winning-party","/politics/british-politics/colchester/winning-party","/politics/british-politics/colne-valley/winning-party","/politics/british-politics/congleton/winning-party","/politics/british-politics/copeland/winning-party","/politics/british-politics/corby/winning-party","/politics/british-politics/cornwall-north/winning-party","/politics/british-politics/cornwall-south-east/winning-party","/politics/british-politics/cotswolds/winning-party","/politics/british-politics/coventry-north-east/winning-party","/politics/british-politics/coventry-north-west/winning-party","/politics/british-politics/coventry-south/winning-party","/politics/british-politics/crawley/winning-party","/politics/british-politics/crewe-and-nantwich/winning-party","/politics/british-politics/croydon-central/winning-party","/politics/british-politics/croydon-north/winning-party","/politics/british-politics/croydon-south/winning-party","/politics/british-politics/cumbernauld-kilsyth-and-kirkintill/winning-party","/politics/british-politics/cynon-valley/winning-party","/politics/british-politics/dagenham-and-rainham/winning-party","/politics/british-politics/darlington/winning-party","/politics/british-politics/dartford/winning-party","/politics/british-politics/daventry/winning-party","/politics/british-politics/delyn/winning-party","/politics/british-politics/denton-and-reddish/winning-party","/politics/british-politics/derby-north/winning-party","/politics/british-politics/derby-south/winning-party","/politics/british-politics/derbyshire-dales/winning-party","/politics/british-politics/derbyshire-mid/winning-party","/politics/british-politics/derbyshire-north-east/winning-party","/politics/british-politics/derbyshire-south/winning-party","/politics/british-politics/devizes/winning-party","/politics/british-politics/devon-central/winning-party","/politics/british-politics/devon-east/winning-party","/politics/british-politics/devon-north/winning-party","/politics/british-politics/devon-sw/winning-party","/politics/british-politics/devon-west-and-torridge/winning-party","/politics/british-politics/dewsbury/winning-party","/politics/british-politics/don-valley/winning-party","/politics/british-politics/doncaster-central/winning-party","/politics/british-politics/doncaster-north/winning-party","/politics/british-politics/dorset-north/winning-party","/politics/british-politics/dorset-south/winning-party","/politics/british-politics/dorset-west/winning-party","/politics/british-politics/dover/winning-party","/politics/british-politics/down-north/winning-party","/politics/british-politics/down-south/winning-party","/politics/british-politics/dudley-north/winning-party","/politics/british-politics/dudley-south/winning-party","/politics/british-politics/dulwich-and-west-norwood/winning-party","/politics/british-politics/dumfries-and-galloway/winning-party","/politics/british-politics/dumfriesshire-clydesdale-and-tweeddale/winning-party","/politics/british-politics/dunbartonshire-east/winning-party","/politics/british-politics/dunbartonshire-west/winning-party","/politics/british-politics/dundee-east/winning-party","/politics/british-politics/dundee-west/winning-party","/politics/british-politics/dunfermline-and-west-fife/winning-party","/politics/british-politics/durham-north/winning-party","/politics/british-politics/durham-north-west/winning-party","/politics/british-politics/dwfor-meirionnydd/winning-party","/politics/british-politics/ealing-central-and-acton/winning-party","/politics/british-politics/ealing-north/winning-party","/politics/british-politics/ealing-southall/winning-party","/politics/british-politics/easington/winning-party","/politics/british-politics/east-ham/winning-party","/politics/british-politics/east-kilbride-strathaven-and-lesma/winning-party","/politics/british-politics/east-lothian/winning-party","/politics/british-politics/eastbourne/winning-party","/politics/british-politics/eastleigh/winning-party","/politics/british-politics/eddisbury/winning-party","/politics/british-politics/edinburgh-east/winning-party","/politics/british-politics/edinburgh-north-and-leith/winning-party","/politics/british-politics/edinburgh-south/winning-party","/politics/british-politics/edinburgh-south-west/winning-party","/politics/british-politics/edinburgh-west/winning-party","/politics/british-politics/edmonton/winning-party","/politics/british-politics/ellesmere-port-and-neston/winning-party","/politics/british-politics/elmet-and-rothwell/winning-party","/politics/british-politics/eltham/winning-party","/politics/british-politics/enfield-north/winning-party","/politics/british-politics/enfield-southgate/winning-party","/politics/british-politics/epping-forest/winning-party","/politics/british-politics/epsom-and-ewell/winning-party","/politics/british-politics/erewash/winning-party","/politics/british-politics/erith-and-thamesmead/winning-party","/politics/british-politics/esher-and-walton/winning-party","/politics/british-politics/exeter/winning-party","/politics/british-politics/falkirk/winning-party","/politics/british-politics/fareham/winning-party","/politics/british-politics/faversham-and-mid-kent/winning-party","/politics/british-politics/feltham-and-heston/winning-party","/politics/british-politics/fife-north-east/winning-party","/politics/british-politics/filton-and-bradley-stoke/winning-party","/politics/british-politics/finchley-and-golders-green/winning-party","/politics/british-politics/folkestone-and-hythe/winning-party","/politics/british-politics/forest-of-dean/winning-party","/politics/british-politics/foyle/winning-party","/politics/british-politics/fylde/winning-party","/politics/british-politics/gainsborough/winning-party","/politics/british-politics/garston-and-halewood/winning-party","/politics/british-politics/gateshead/winning-party","/politics/british-politics/gedling/winning-party","/politics/british-politics/gillingham-and-rainham/winning-party","/politics/british-politics/glasgow-central/winning-party","/politics/british-politics/glasgow-east/winning-party","/politics/british-politics/glasgow-north/winning-party","/politics/british-politics/glasgow-north-east/winning-party","/politics/british-politics/glasgow-north-west/winning-party","/politics/british-politics/glasgow-south/winning-party","/politics/british-politics/glasgow-south-west/winning-party","/politics/british-politics/glenrothes/winning-party","/politics/british-politics/gloucester/winning-party","/politics/british-politics/gordon/winning-party","/politics/british-politics/gosport/winning-party","/politics/british-politics/gower/winning-party","/politics/british-politics/grantham-and-stamford/winning-party","/politics/british-politics/gravesham/winning-party","/politics/british-politics/great-grimsby/winning-party","/politics/british-politics/great-yarmouth/winning-party","/politics/british-politics/greenwich-and-woolwich/winning-party","/politics/british-politics/guildford/winning-party","/politics/british-politics/hackney-north-and-stoke-newington/winning-party","/politics/british-politics/hackney-south-and-shoreditch/winning-party","/politics/british-politics/halesowen-and-rowley-regis/winning-party","/politics/british-politics/halifax/winning-party","/politics/british-politics/haltemprice-and-howden/winning-party","/politics/british-politics/halton/winning-party","/politics/british-politics/hammersmith/winning-party","/politics/british-politics/hampshire-east/winning-party","/politics/british-politics/hampshire-north-east/winning-party","/politics/british-politics/hampshire-north-west/winning-party","/politics/british-politics/hampstead-and-kilburn/winning-party","/politics/british-politics/harborough/winning-party","/politics/british-politics/harbough/winning-party","/politics/british-politics/harlow/winning-party","/politics/british-politics/harrogate-and-knaresborough/winning-party","/politics/british-politics/harrow-east/winning-party","/politics/british-politics/harrow-west/winning-party","/politics/british-politics/hartlepool/winning-party","/politics/british-politics/harwich-and-north-essex/winning-party","/politics/british-politics/hastings-and-rye/winning-party","/politics/british-politics/havant/winning-party","/politics/british-politics/hayes-and-harlington/winning-party","/politics/british-politics/hazel-grove/winning-party","/politics/british-politics/hemel-hempstead/winning-party","/politics/british-politics/hemsworth/winning-party","/politics/british-politics/hendon/winning-party","/politics/british-politics/henley/winning-party","/politics/british-politics/hereford-and-south-herefordshire/winning-party","/politics/british-politics/herefordshire-north/winning-party","/politics/british-politics/hertford-and-stortford/winning-party","/politics/british-politics/hertfordshire-ne/winning-party","/politics/british-politics/hertfordshire-south-wes/winning-party","/politics/british-politics/hertsmere/winning-party","/politics/british-politics/hexham/winning-party","/politics/british-politics/heywood-and-middleton/winning-party","/politics/british-politics/high-peak/winning-party","/politics/british-politics/hitchin-and-harpenden/winning-party","/politics/british-politics/holborn-and-st-pancras/winning-party","/politics/british-politics/hornchurch-and-upminster/winning-party","/politics/british-politics/hornsey-and-wood-green/winning-party","/politics/british-politics/horsham/winning-party","/politics/british-politics/houghton-and-sunderland-so/winning-party","/politics/british-politics/hove/winning-party","/politics/british-politics/huddersfield/winning-party","/politics/british-politics/hull-east/winning-party","/politics/british-politics/hull-north/winning-party","/politics/british-politics/hull-west-and-hessle/winning-party","/politics/british-politics/huntingdon/winning-party","/politics/british-politics/hyndburn/winning-party","/politics/british-politics/ilford-north/winning-party","/politics/british-politics/ilford-south/winning-party","/politics/british-politics/inverclyde/winning-party","/politics/british-politics/inverness-nairn-badenoch-and-strathspey/winning-party","/politics/british-politics/ipswich/winning-party","/politics/british-politics/isle-of-wight/winning-party","/politics/british-politics/islington-north/winning-party","/politics/british-politics/islington-s-and-finsbury/winning-party","/politics/british-politics/islwyn/winning-party","/politics/british-politics/jarrow/winning-party","/politics/british-politics/keighley/winning-party","/politics/british-politics/kenilworth-and-southam/winning-party","/politics/british-politics/kensington/winning-party","/politics/british-politics/kensington/conservative-candidate","/politics/british-politics/kensington/kensington-constituency-special","/politics/british-politics/kettering/winning-party","/politics/british-politics/kilmarnock-and-loudoun/winning-party","/politics/british-politics/kingston-upon-hull-north/winning-party","/politics/british-politics/kingston-and-surbiton/winning-party","/politics/british-politics/kingston-upon-hull-east/winning-party","/politics/british-politics/kingswood/winning-party","/politics/british-politics/kirkcaldy-and-cowdenbeath/winning-party","/politics/british-politics/knowsley/winning-party","/politics/british-politics/lagan-valley/winning-party","/politics/british-politics/lanark-and-hamilton-east/winning-party","/politics/british-politics/lancashire-west/winning-party","/politics/british-politics/lancaster-and-fleetwood/winning-party","/politics/british-politics/leeds-central/winning-party","/politics/british-politics/leeds-east/winning-party","/politics/british-politics/leeds-north-east/winning-party","/politics/british-politics/leeds-north-west/winning-party","/politics/british-politics/leeds-west/winning-party","/politics/british-politics/leicester-east/winning-party","/politics/british-politics/leicester-south/winning-party","/politics/british-politics/leicester-west/winning-party","/politics/british-politics/leicestershire-nw/winning-party","/politics/british-politics/leicestershire-south/winning-party","/politics/british-politics/leigh/winning-party","/politics/british-politics/lewes/winning-party","/politics/british-politics/lewisham-deptford/winning-party","/politics/british-politics/lewisham-east/winning-party","/politics/british-politics/lewisham-west-and-penge/winning-party","/politics/british-politics/leyton-and-wanstead/winning-party","/politics/british-politics/lichfield/winning-party","/politics/british-politics/lincoln/winning-party","/politics/british-politics/linlithgow-and-falkirk-ea/winning-party","/politics/british-politics/liverpool-riverside/winning-party","/politics/british-politics/liverpool-walton/winning-party","/politics/british-politics/liverpool-wavertree/winning-party","/politics/british-politics/liverpool-west-derby/winning-party","/politics/british-politics/livingston/winning-party","/politics/british-politics/llanelli/winning-party","/politics/british-politics/londonderry-east/winning-party","/politics/british-politics/loughborough/winning-party","/politics/british-politics/louth-and-horncastle/winning-party","/politics/british-politics/ludlow/winning-party","/politics/british-politics/luton-north/winning-party","/politics/british-politics/luton-south/winning-party","/politics/british-politics/macclesfield/winning-party","/politics/british-politics/maidenhead/winning-party","/politics/british-politics/maidstone-and-weald/winning-party","/politics/british-politics/makerfield/winning-party","/politics/british-politics/maldon/winning-party","/politics/british-politics/manchester-central/winning-party","/politics/british-politics/manchester-gorton/winning-party","/politics/british-politics/manchester-withington/winning-party","/politics/british-politics/mansfield/winning-party","/politics/british-politics/meon-valley/winning-party","/politics/british-politics/meriden/winning-party","/politics/british-politics/merthyr-tydfil-and-rhymney/winning-party","/politics/british-politics/mid-dorset-and-north-poole/winning-party","/politics/british-politics/middlesbrough/winning-party","/politics/british-politics/middlesbrough-south-and-east-cleveland/winning-party","/politics/british-politics/midlothian/winning-party","/politics/british-politics/milton-keynes-north/winning-party","/politics/british-politics/milton-keynes-south/winning-party","/politics/british-politics/mitcham-and-morden/winning-party","/politics/british-politics/mole-valley/winning-party","/politics/british-politics/monmouth/winning-party","/politics/british-politics/montgomeryshire/winning-party","/politics/british-politics/moray/winning-party","/politics/british-politics/morecambe-and-lunsdale/winning-party","/politics/british-politics/morley-and-outwood/winning-party","/politics/british-politics/motherwell-and-wishaw/winning-party","/politics/british-politics/na-h-eileanan-an-iar/winning-party","/politics/british-politics/neath/winning-party","/politics/british-politics/new-forest-east/winning-party","/politics/british-politics/new-forest-west/winning-party","/politics/british-politics/newark/winning-party","/politics/british-politics/newbury/winning-party","/politics/british-politics/newcastle-upon-tyne-cen/winning-party","/politics/british-politics/newcastle-upon-tyne-east/winning-party","/politics/british-politics/newcastle-upon-tyne-nrth/winning-party","/politics/british-politics/newcastle-under-lyme/winning-party","/politics/british-politics/newport-east/winning-party","/politics/british-politics/newport-west/winning-party","/politics/british-politics/newry-and-armagh/winning-party","/politics/british-politics/newton-abbot/winning-party","/politics/british-politics/norfolk-mid/winning-party","/politics/british-politics/norfolk-north/winning-party","/politics/british-politics/norfolk-north-west/winning-party","/politics/british-politics/norfolk-south/winning-party","/politics/british-politics/norfolk-south-west/winning-party","/politics/british-politics/normanton-pontefract-castleford/winning-party","/politics/british-politics/north-warwickshire/winning-party","/politics/british-politics/northampton-north/winning-party","/politics/british-politics/northampton-south/winning-party","/politics/british-politics/northamptonshire-south/winning-party","/politics/british-politics/norwich-north/winning-party","/politics/british-politics/norwich-south/winning-party","/politics/british-politics/nottingham-east/winning-party","/politics/british-politics/nottingham-north/winning-party","/politics/british-politics/nottingham-south/winning-party","/politics/british-politics/nuneaton/winning-party","/politics/british-politics/ochill-and-sth-perthshire/winning-party","/politics/british-politics/ogmore/winning-party","/politics/british-politics/old-bexley-and-sidcup/winning-party","/politics/british-politics/oldham-east-and-saddleworth/winning-party","/politics/british-politics/oldham-west-and-royton/winning-party","/politics/british-politics/orkney-and-shetland/winning-party","/politics/british-politics/orpington/winning-party","/politics/british-politics/oxford-east/winning-party","/politics/british-politics/oxford-west-and-abingdon/winning-party","/politics/british-politics/paisley-and-renf-north/winning-party","/politics/british-politics/paisley-and-renf-south/winning-party","/politics/british-politics/pendle/winning-party","/politics/british-politics/penistone-and-stocksbridge/winning-party","/politics/british-politics/penrith-and-the-border/winning-party","/politics/british-politics/perth-and-n-perthshire/winning-party","/politics/british-politics/peterborough/winning-party","/politics/british-politics/plymouth-moor-view/winning-party","/politics/british-politics/plymouth-sutton-and-devonport/winning-party","/politics/british-politics/pontypridd/winning-party","/politics/british-politics/poole/winning-party","/politics/british-politics/poplar-and-limehouse/winning-party","/politics/british-politics/portsmouth-north/winning-party","/politics/british-politics/portsmouth-south/winning-party","/politics/british-politics/preseli-pembrokeshire/winning-party","/politics/british-politics/preston/winning-party","/politics/british-politics/pudsey/winning-party","/politics/british-politics/putney/winning-party","/politics/british-politics/rayleigh-and-wickford/winning-party","/politics/british-politics/reading-east/winning-party","/politics/british-politics/reading-west/winning-party","/politics/british-politics/redcar/winning-party","/politics/british-politics/redditch/winning-party","/politics/british-politics/reigate/winning-party","/politics/british-politics/renfrewshire-east/winning-party","/politics/british-politics/rhondda/winning-party","/politics/british-politics/ribble-south/winning-party","/politics/british-politics/ribble-valley/winning-party","/politics/british-politics/richmond-park/winning-party","/politics/british-politics/richmond-yorks/winning-party","/politics/british-politics/rochdale/winning-party","/politics/british-politics/rochester-and-strood/winning-party","/politics/british-politics/rochford-and-southend-east/winning-party","/politics/british-politics/romford/winning-party","/politics/british-politics/romsey-and-southampton-north/winning-party","/politics/british-politics/ross-skye-and-lochaber/winning-party","/politics/british-politics/rossendale-and-darwen/winning-party","/politics/british-politics/rother-valley/winning-party","/politics/british-politics/rotherham/winning-party","/politics/british-politics/rugby/winning-party","/politics/british-politics/ruislip-northwood-and-pinner/winning-party","/politics/british-politics/runnymede-and-weybridge/winning-party","/politics/british-politics/rushcliffe/winning-party","/politics/british-politics/rutherglen-and-hamilton-west/winning-party","/politics/british-politics/rutland-and-melton/winning-party","/politics/british-politics/saffron-walden/winning-party","/politics/british-politics/salford-and-eccles/winning-party","/politics/british-politics/salisbury/winning-party","/politics/british-politics/scarborough-and-whitby/winning-party","/politics/british-politics/scunthorpe/winning-party","/politics/british-politics/sedgefield/winning-party","/politics/british-politics/sefton-central/winning-party","/politics/british-politics/selby-and-ainsty/winning-party","/politics/british-politics/sevenoaks/winning-party","/politics/british-politics/sheffield-brightside-and-hillsborough/winning-party","/politics/british-politics/sheffield-central/winning-party","/politics/british-politics/sheffield-hallam/winning-party","/politics/british-politics/sheffield-heely/winning-party","/politics/british-politics/sheffield-south-east/winning-party","/politics/british-politics/sherwood/winning-party","/politics/british-politics/shipley/winning-party","/politics/british-politics/shrewsbury-and-atcham/winning-party","/politics/british-politics/shropshire-north/winning-party","/politics/british-politics/sittingbourne-and-sheppey/winning-party","/politics/british-politics/skipton-and-ripon/winning-party","/politics/british-politics/sleaford-and-n-hykeham/winning-party","/politics/british-politics/slough/winning-party","/politics/british-politics/solihull/winning-party","/politics/british-politics/somerset-north/winning-party","/politics/british-politics/somerset-north-east/winning-party","/politics/british-politics/somerton-and-frome/winning-party","/politics/british-politics/south-holland-and-the-deepings/winning-party","/politics/british-politics/south-shields/winning-party","/politics/british-politics/southampton-itchen/winning-party","/politics/british-politics/southampton-test/winning-party","/politics/british-politics/southend-west/winning-party","/politics/british-politics/southport/winning-party","/politics/british-politics/spelthorne/winning-party","/politics/british-politics/st-albans/winning-party","/politics/british-politics/st-austell-and-newquay/winning-party","/politics/british-politics/st-helens-north/winning-party","/politics/british-politics/st-helens-south/winning-party","/politics/british-politics/st-ives/winning-party","/politics/british-politics/stafford/winning-party","/politics/british-politics/staffordshire-moorlands/winning-party","/politics/british-politics/staffordshire-south/winning-party","/politics/british-politics/stalybridge-and-hyde/winning-party","/politics/british-politics/stevenage/winning-party","/politics/british-politics/stirling/winning-party","/politics/british-politics/stockport/winning-party","/politics/british-politics/stockton-north/winning-party","/politics/british-politics/stockton-south/winning-party","/politics/british-politics/stoke-on-trent-central/winning-party","/politics/british-politics/stoke-on-trent-north/winning-party","/politics/british-politics/stoke-on-trent-south/winning-party","/politics/british-politics/stone/winning-party","/politics/british-politics/stourbridge/winning-party","/politics/british-politics/strangford/winning-party","/politics/british-politics/stratford-on-avon/winning-party","/politics/british-politics/streatham/winning-party","/politics/british-politics/stretford-and-urmston/winning-party","/politics/british-politics/stroud/winning-party","/politics/british-politics/suffolk-central-and-ipswich-north/winning-party","/politics/british-politics/suffolk-coastal/winning-party","/politics/british-politics/suffolk-south/winning-party","/politics/british-politics/suffolk-west/winning-party","/politics/british-politics/sunderland-central/winning-party","/politics/british-politics/surrey-east/winning-party","/politics/british-politics/surrey-heath/winning-party","/politics/british-politics/surrey-south-west/winning-party","/politics/british-politics/sussex-mid/winning-party","/politics/british-politics/sutton-coldfield/winning-party","/politics/british-politics/sutton-and-cheam/winning-party","/politics/british-politics/swansea-east/winning-party","/politics/british-politics/swansea-west/winning-party","/politics/british-politics/swindon-north/winning-party","/politics/british-politics/swindon-south/winning-party","/politics/british-politics/tamworth/winning-party","/politics/british-politics/tatton/winning-party","/politics/british-politics/taunton-deane/winning-party","/politics/british-politics/telford/winning-party","/politics/british-politics/tewkesbury/winning-party","/politics/british-politics/thanet-north/winning-party","/politics/british-politics/thanet-south/winning-party","/politics/british-politics/thanet-south/most-votes-match-bet","/politics/british-politics/thanet-south/pub-landlord-specials","/politics/british-politics/thanet-south/to-save-deposit","/politics/british-politics/thanet-south/will-al-murray-retain-his-deposit","/politics/british-politics/the-wrekin/winning-party","/politics/british-politics/thirsk-and-malton/winning-party","/politics/british-politics/thornbury-and-yate/winning-party","/politics/british-politics/thurrock/winning-party","/politics/british-politics/tiverton-and-honiton/winning-party","/politics/british-politics/tonbridge-and-malling/winning-party","/politics/british-politics/tooting/winning-party","/politics/british-politics/torbay/winning-party","/politics/british-politics/torfaen/winning-party","/politics/british-politics/totnes/winning-party","/politics/british-politics/tottenham/winning-party","/politics/british-politics/truro-and-falmouth/winning-party","/politics/british-politics/tunbridge-wells/winning-party","/politics/british-politics/twickenham/winning-party","/politics/british-politics/tynemouth/winning-party","/politics/british-politics/tyneside-north/winning-party","/politics/british-politics/tyrone-west/winning-party","/politics/british-politics/ulster-mid/winning-party","/politics/british-politics/upper-bann/winning-party","/politics/british-politics/uxbridge-and-south-ruislip/winning-party","/politics/british-politics/vale-of-clwyd/winning-party","/politics/british-politics/vale-of-glamorgan/winning-party","/politics/british-politics/vauxhall/winning-party","/politics/british-politics/wakefield/winning-party","/politics/british-politics/wallasey/winning-party","/politics/british-politics/walsall-north/winning-party","/politics/british-politics/walsall-south/winning-party","/politics/british-politics/walthamstow/winning-party","/politics/british-politics/wansbeck/winning-party","/politics/british-politics/wantage/winning-party","/politics/british-politics/warley/winning-party","/politics/british-politics/warrington-north/winning-party","/politics/british-politics/warrington-south/winning-party","/politics/british-politics/warwick-and-leamington/winning-party","/politics/british-politics/washington-and-sunderland-west/winning-party","/politics/british-politics/watford/winning-party","/politics/british-politics/waveney/winning-party","/politics/british-politics/wealden/winning-party","/politics/british-politics/weaver-vale/winning-party","/politics/british-politics/wellingborough/winning-party","/politics/british-politics/wells/winning-party","/politics/british-politics/welwyn-hatfield/winning-party","/politics/british-politics/wentworth-and-dearne/winning-party","/politics/british-politics/west-bromwich-east/winning-party","/politics/british-politics/west-bromwich-west/winning-party","/politics/british-politics/west-ham/winning-party","/politics/british-politics/westminster-north/winning-party","/politics/british-politics/westmorland-and-lonsdale/winning-party","/politics/british-politics/weston-super-mare/winning-party","/politics/british-politics/wigan/winning-party","/politics/british-politics/wiltshire-north/winning-party","/politics/british-politics/wiltshire-south-west/winning-party","/politics/british-politics/wimbledon/winning-party","/politics/british-politics/winchester/winning-party","/politics/british-politics/windsor/winning-party","/politics/british-politics/wirral-south/winning-party","/politics/british-politics/wirral-west/winning-party","/politics/british-politics/witham/winning-party","/politics/british-politics/witney/winning-party","/politics/british-politics/woking/winning-party","/politics/british-politics/wokingham/winning-party","/politics/british-politics/wolverhampton-n-east/winning-party","/politics/british-politics/wolverhampton-s-east/winning-party","/politics/british-politics/wolverhampton-s-west/winning-party","/politics/british-politics/worcester/winning-party","/politics/british-politics/worcestershire-mid/winning-party","/politics/british-politics/worcestershire-west/winning-party","/politics/british-politics/workington/winning-party","/politics/british-politics/worsley-and-eccles-south/winning-party","/politics/british-politics/worthing-east-and-shoreham/winning-party","/politics/british-politics/worthing-west/winning-party","/politics/british-politics/wrexham/winning-party","/politics/british-politics/wycombe/winning-party","/politics/british-politics/wyre-forest/winning-party","/politics/british-politics/wyre-and-preston-north/winning-party","/politics/british-politics/wythenshawe-and-sale-east/winning-party","/politics/british-politics/yeovil/winning-party","/politics/british-politics/ynys-mon/winning-party","/politics/british-politics/york-central/winning-party","/politics/british-politics/york-outer/winning-party","/politics/british-politics/yorkshire-east/winning-party"]
for const in constituencyslugs:
  odds=oddsGrabber_constituency(const,{'typ':typ,'const':const})
  oddsdata=oddsParser(odds)
  scraperwiki.sqlite.save(unique_keys=[],table_name='full', data=oddsdata)
# import lxml.html
#
# # Read in a page
# html = scraperwiki.scrape("http://foo.com")
#
# # Find something on the page using css selectors
# root = lxml.html.fromstring(html)
# root.cssselect("div[align='left']")
#
# # Write out to the sqlite database using scraperwiki library
# scraperwiki.sqlite.save(unique_keys=['name'], data={"name": "susan", "occupation": "software developer"})
#
# # An arbitrary query against the database
# scraperwiki.sql.select("* from data where 'name'='peter'")

# You don't have to do things with the ScraperWiki and lxml libraries. You can use whatever libraries are installed
# on Morph for Python (https://github.com/openaustralia/morph-docker-python/blob/master/pip_requirements.txt) and all that matters
# is that your final data is written to an Sqlite database called data.sqlite in the current working directory which
# has at least a table called data.
